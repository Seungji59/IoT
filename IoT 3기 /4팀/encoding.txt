import face_recognition
import numpy as np
import os

ENCODING_DIR = "/home/pi5/face_project/encodings"
os.makedirs(ENCODING_DIR, exist_ok=True)

BASE_DIR = "/home/pi5/face_project"

user_images = [
    (os.path.join(BASE_DIR, "user_이수시.jpg"), "user1"),
    (os.path.join(BASE_DIR, "user_teawoo.jpg"), "user2"),
    (os.path.join(BASE_DIR, "user3.jpg"), "user3"),
]

for img_file, name in user_images:
    try:
        print(f"encoding: {img_file} → {name}")
        image = face_recognition.load_image_file(img_file)

        # 얼굴 위치 먼저 감지
        face_locations = face_recognition.face_locations(image)
        if not face_locations:
            print(f"error: {img_file} (no face detected)")
            continue

        # 얼굴 인코딩
        encodings = face_recognition.face_encodings(image, known_face_locations=face_locations)
        if len(encodings) == 0:
            print(f"error: {img_file} (encoding failed)")
            continue

        # 저장
        np.save(os.path.join(ENCODING_DIR, f"{name}.npy"), encodings[0])
        print(f"success: {ENCODING_DIR}/{name}.npy")

    except FileNotFoundError:
        print(f"skip: {img_file} (file not found)")

    except Exception as e:
        print(f"error: {img_file} (unexpected error: {e})")
